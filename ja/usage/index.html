---
"layout": "document"
"directory": "usage/"
"title": "Sisimaiでの解析方法"
"description": "Sisimaiの解析方法・オプション・コールバック機能"
"author": "azumakuniyuki"
---

<a id = 'tohash' href = '#'></a>
<header id = 'home'>
    <div class = 'main-nav'>
        <div class = 'container'>
            <div class = 'navbar-header'>
                <button type = 'button' class = 'navbar-toggle' data-toggle = 'collapse' data-target = '.navbar-collapse'>
                    <span class = 'sr-only'>Toggle navigation</span>
                    <span class = 'icon-bar'></span>
                    <span class = 'icon-bar'></span>
                    <span class = 'icon-bar'></span>
                </button>
                <a class = 'navbar-brand' href = '/'>
                    <h1>
                        <img class = 'img-responsive' src = '/static/images/logo/sisimai-logotype-w11.png' 
                            width = '144' alt = 'Sisimai: Mail Analyzing Interface'>
                    </h1>
                </a>
            </div>
            <div class = 'collapse navbar-collapse'>
                <ul class = 'nav navbar-nav navbar-right'>
                    <li class = 'scroll'><a href = '/ja'><i class = 'fa fa-home'></i></a></li> 
                    <li class = 'scroll active'><a href = '#index'><i class = 'fa fa-arrow-circle-up'></i></a></li> 
                    <li class = 'scroll'><a href = '#stdin'>標準入力</a></li>
                    <li class = 'scroll'><a href = '#memory'>変数から</a></li>
                    <li class = 'scroll'><a href = '#delivered'>配信成功も</a></li>
                    <li class = 'scroll'><a href = '#vacation'>不在応答も</a></li>
                    <li class = 'scroll'><a href = '#callback'>コールバック</a></li>
                    <li class = 'others'><a href = '/ja/docs/'>ドキュメント</a></li>
                    <li class = 'others'><a href = '/en/usage/'><i class = 'fa fa-language'></i></a></li>
                    <li class = 'others'><a href = 'https://github.com/sisimai' target = 'new'><i class = 'fa fa-github'></i></a></li>
                </ul>
            </div>
        </div>
    </div> <!-- /#main-nav -->
</header> <!-- /#home -->

<section id = 'index'>
    <div class = 'container'>
        <div class = 'heading'>
            <div class = 'row'>
                <div class = 'text-center col-sm-8 col-sm-offset-2'>
                    <img src = '/static/images/logo/sisimai-x01.png' width = '20%'>
                    <h2>シシマイでの解析方法</h2>
                </div>
            </div>
        </div>
        <div class = 'text-center index-table'>
            <div class = 'row'>
                <div class = 'col-sm-4'>
                    <div class = 'index-icon'>
                        <i class = 'fa fa-keyboard'></i>
                    </div>
                    <div class = 'index-info'>
                        <h3>基本的な使い方</h3>
                        <p class = 'description ja'>
                            メールの解析、構造化されたデータやJSON文字列の取得など、
                            シシマイが使える環境にバウンスメールを用意すれば直ぐに解析結果を得られる
                            最も簡単で基本的な使い方を紹介します。
                        </p>
                    </div>
                    <a href = '/ja/start/#usage' class = 'btn btn-continue'>Read</a>
                </div>
                <div class = 'col-sm-4'>
                    <div class = 'index-icon'>
                        <i class = 'fa fa-desktop'></i>
                    </div>
                    <div class = 'index-info'>
                        <h3>標準入力を読む</h3>
                        <p class = 'description ja'>
                            標準入力(STDIN)からバウンスメールのデータを読み込み、
                            シシマイで解析する方法の記述例です。
                            PerlやRubyのワンライナーでパイプラインを経由して
                            読み込む場合に便利な入力方法です。
                        </p>
                    </div>
                    <a href = '#stdin' class = 'btn btn-continue'>Read</a>
                </div>
                <div class = 'col-sm-4'>
                    <div class = 'index-icon'>
                        <i class = 'fa fa-dollar-sign'></i>
                    </div>
                    <div class = 'index-info'>
                        <h3>変数から読む</h3>
                        <p class = 'description ja'>
                            変数からバウンスメールのデータを読み込み
                            シシマイで解析する方法の記述例です。バウンスメール
                            をデータベースやジョブキューシステムから読み出して
                            解析する場合に便利な方法です。
                        </p>
                    </div>
                    <a href = '#memory' class = 'btn btn-continue'>Read</a>
                </div>
            </div>

            <div class = 'row'>
                <div class = 'col-sm-4'>
                    <div class = 'index-icon'>
                        <i class = 'fa fa-truck'></i>
                    </div>
                    <div class = 'index-info'>
                        <h3>配信成功も含む</h3>
                        <p class = 'description ja'>
                            {{ site.html.ss }}は既定の動作で配信できなかったメールだけを解析結果として
                            出力しますが、配信が成功したメール(配信通知)も解析結果に含める
                            {{ site.html.ss }}クラスのメソッド使用方法を紹介します。
                        </p>
                    </div>
                    <a href = '#delivered' class = 'btn btn-continue'>Read</a>
                </div>
                <div class = 'col-sm-4'>
                    <div class = 'index-icon'>
                        <i class = 'fa fa-plane-departure'></i>
                    </div>
                    <div class = 'index-info'>
                        <h3>不在応答も含む</h3>
                        <p class = 'description ja'>
                            {{ site.html.ss }}は既定の動作で配信できなかったメールだけを解析結果として
                            出力しますが、不在応答(Vacation)で返ってきたメールも解析結果に含める
                            {{ site.html.ss }}クラスのメソッド使用方法を紹介します。
                        </p>
                    </div>
                    <a href = '#vacation' class = 'btn btn-continue'>Read</a>
                </div>
                <div class = 'col-sm-4'>
                    <div class = 'index-icon'>
                        <i class = 'fa fa-reply-all'></i>
                    </div>
                    <div class = 'index-info'>
                        <h3>コールバック</h3>
                        <p class = 'description ja'>
                            コールバック機能を使うとシシマイが解析する前のデータ
                            に対して、特定ヘッダの取得や部分的な書き換えなど、
                            独自の処理を行い、その結果を解析データに含めることができます。
                        </p>
                    </div>
                    <a href = '#callback' class = 'btn btn-continue'>Read</a>
                </div>
            </div>
        </div>
    </div>
</section> <!-- /#index -->

<section id = 'stdin' class = 'parallax'>
    <div class = 'container'>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'post-it'>
                    <i class = 'fa fa-desktop'></i>
                </div>
            </div>
            <div class = 'heading col-sm-8 col-sm-offset-0'>
                <h2 class = 'in-desc'>標準入力から読む</h2>
                <hr>
                <p class = 'description ja cation'>
                    <span class = 'value'>Sisimai</span>クラスの
                    <span class = 'value'>make()</span>メソッドは{{ site.html.ss }} 5.0.0で廃止になりました。
                    新たに実装された<span class = 'value'>rise()</span>メソッドをかわりに使ってください。
                </p>
                <p class = 'description ja'>
                    {{ site.html.ss }}(シシマイ)の<span class = 'value'>rise()</span>や<span class = 'value'>dump()</span>メソッドは、
                    引数にファイル名を指定する以外に、<kbd>STDIN</kbd>を指定することによって、
                    標準入力(STDIN)からバウンスメールのデータを読み込むことができます。
                    この機能は初期の{{ site.html.ss }}から実装されていましたが、バグがあったため、
                    読み込みができない場合がありました。このバグはSisimai 4.18.1
                    <a href = 'https://github.com/sisimai/p5-sisimai/issues/194' target = 'new'>
                    (Perl版)
                    </a>
                    <a href = 'https://github.com/sisimai/rb-sisimai/issues/61' target = 'new'>
                    (Ruby版)
                    </a>
                    にて修正済みです。
                </p>
            </div>
        </div>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Perl</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>STDINファイルハンドル(Perl)</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/dinosaur-1.png'>
                    <span class = 'value'>Sisimai</span>クラスの<span class = 'value'>dump()</span>と
                    <span class = 'value'>rise()</span>メソッドは、第一引数にファイルハンドル<kbd>STDIN</kbd>を指定すると、
                    標準入力からバウンスメールのデータを読み込み、解析結果を返します。
                </p>

                <pre class = 'prettyprint'>
% <kbd>cat ./path/to/email | perl -MSisimai -lE 'print Sisimai->dump(STDIN)' | jq</kbd>
[
  {
    "listid": "",
    "smtpagent": "Sendmail",
    ...
                </pre>
                <pre class = 'prettyprint'>
% <kbd>cat ./path/to/email | perl -MSisimai -lE 'print $_->recipient->address for @{ Sisimai->rise(STDIN) }'</kbd>
kijitora@example.jp
sironeko@example.org
                </pre>
            </div>

            <div class = 'col-sm-8 col-sm-offset-2'>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Ruby</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>STDINオブジェクト(Ruby)</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/ruby-1.png'>
                    Ruby版{{ site.html.ss }}も同様に、<span class = 'value'>Sisimai</span>クラスの
                    <span class = 'value'>dump()</span>と<span class = 'value'>rise()</span>メソッドの
                    第一引数に<kbd>STDIN</kbd>オブジェクトを指定すると、
                    標準入力からバウンスメールのデータを読み込み、解析結果を返します。
                </p>
                <pre class = 'prettyprint'>
% <kbd>cat ./path/to/email | ruby -Ilib -rsisimai -e 'puts Sisimai.dump(STDIN)' | jq</kbd>
[
  {
    "catch": "",
    "token": "d295b517a3ad6f8748031e1068e07ebd089c0277",
    ...
                </pre>
                <pre class = 'prettyprint'>
% <kbd>cat ./path/to/email | ruby -rsisimai -e 'p Sisimai.rise(STDIN)'</kbd>
[#&lt;Sisimai::Data:0x007fa1b0993050 @addresser=#&lt;Sisimai::Address:0x007fa1b0990e40 @user="kijitora", ...
                </pre>
            </div>

            <div class = 'col-sm-8 col-sm-offset-2'>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Go</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>文字列"STDIN" (Go)</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/golang-1.png' width = '80'>
                    Go版{{ site.html.ss }}も同様に、<span class = 'value'>libsisimai.org/sisimai</span>パッケージの
                    <span class = 'value'>Rise()</span>と<span class = 'value'>Dump()</span>関数の
                    第一引数に文字列<kbd>"STDIN"</kbd>を指定すると、
                    標準入力からバウンスメールのデータを読み込み、解析結果を返します。
                </p>
                <pre class = 'prettyprint'><span class = 'shebang'>package main</span>
import "fmt"
import "libsisimai.org/sisimai"

func main() {
    args := sisimai.Args()
    json, _ := sisimai.Dump("STDIN", args)
    if json != nil && *json != "" { fmt.Printf("%s\n", *json) }
}
                </pre>
                <pre class = 'prettyprint'>% <kbd>cat ./path/to/email | go run ./sisid.go | jq</kbd>
[
  {
    "catch": "",
    "token": "d295b517a3ad6f8748031e1068e07ebd089c0277",
    ...
                </pre>
            </div>

            <div class = 'col-sm-8 col-sm-offset-2'>
            </div>
        </div>

    </div>
</section> <!-- /#stdin -->

<section id = 'memory'>
    <div class = 'container'>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'post-it'>
                    <i class = 'fa fa-dollar-sign'></i>
                </div>
            </div>
            <div class = 'heading col-sm-8 col-sm-offset-0'>
                <h2 class = 'in-desc'>変数から読み込む</h2>
                <p class = 'description ja cation'>
                    <span class = 'value'>Sisimai</span>クラスの
                    <span class = 'value'>make()</span>メソッドは{{ site.html.ss }} 5.0.0で廃止になりました。
                    新たに実装された<span class = 'value'>rise()</span>メソッドをかわりに使ってください。
                </p>
                <p class = 'description ja'>
                <span class = 'value'>Sisimai</span>クラスの<span class = 'value'>rise()</span>と
                <span class = 'value'>dump()</span>の第一引数に変数
                (Perlではスカラーリファレンス・Rubyでは<span class = 'value'>String</span>オブジェクト・Goでは文字列)
                を指定することによって、ファイルとしてのメールや標準入力以外からバウンスメールのデータを読み込むことができます。
                </p>
                <p class = 'description ja'>
                    バウンスメールをデータベースやジョブキューシステムから読み出す場合に有用なこの機能
                    (<span class = 'value'>Sisimai::Mail::Memory</span class = 'value'>)は{{ site.html.ss }} 4.23.0で実装されました。
                </p>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Perl</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>Scalar Reference</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/dinosaur-1.png'>
                    <span class = 'value'>rise()</span>と<span class = 'value'>dump()</span>の第一引数に
                    <strong>スカラーリファレンス</strong>を指定すると、
                    {{ site.html.ss }}内部では<span class = 'value'>Sisimai::Mail::Memory</span>が呼び出され、
                    メールのファイルや標準入力から読み込んだのと同様、解析結果が得られます。
                </p>
                <pre class = 'prettyprint'><span class = 'shebang'>#! /usr/bin/env perl</span>
use Sisimai;
my $f = 'From MAILER-DAEMON Thu Dec 22 17:54:04 2015...';   # バウンスメール全体
my $v = Sisimai->rise(\$f);
for my $e ( @$v ) {
    print $e->action;           # "delayed"
    print $e->deliverystatus;   # "4.7.0"
    print $e->reason;           # "expired"
    print $e->diagnosticcode;   # "Envelope expired"
    print $e->hardbounce;       # 0
}
                </pre>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Ruby</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>String Object</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/ruby-1.png'>
                    Ruby版{{ site.html.ss }}では<span class = 'value'>rise()</span>と
                    <span class = 'value'>dump()</span>の第一引数に<strong>Stringオブジェクト</strong>
                    を指定すると、{{ site.html.ss }}内部で<span class = 'value'>Sisimai::Mail::Memory</span>
                    が呼び出され、メールのファイルや標準入力から読み込んだのと同様、解析結果が得られます。
                </p>
                <pre class = 'prettyprint'><span class = 'shebang'>#! /usr/bin/env ruby</span>
require 'sisimai'
f = 'From MAILER-DAEMON Thu Dec 22 17:54:04 2015...'    # バウンスメール全体
v = Sisimai.rise(f)
v.each do |e|
  puts e.action         # "delayed"
  puts e.deliverystatus # "4.7.0"
  puts e.reason         # "expired"
  puts e.diagnosticcode # "Envelope expired"
  puts e.hardbounce     # false
end
                </pre>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Go</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>文字列としてのメール内容</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/golang-1.png' width = '80'>
                    <span class = 'value'>Rise()</span>関数と<span class = 'value'>Dump()</span>関数の第一引数に
                    バウンスメール全体を含んだ<strong>文字列</strong>を指定すると、{{ site.html.ss }}内部では
                    <span class = 'value'>libisismai.org/sisimai/mail/memory</span>が呼び出され、
                    メールのファイルや標準入力から読み込んだのと同様に、解析結果が得られます。
                </p>
                <pre class = 'prettyprint'><span class = 'shebang'>package main</span>
import "fmt"
import "libsisimai.org/sisimai"

func main() {
    mail := 'From MAILER-DAEMON Fri Feb  2 18:30:22 2018...'    // バウンスメール全体
    args := sisimai.Args()
    data, _ := sisimai.Rise(mail, args)
    if len(*data) &gt; 0 { fmt.Printf("%s\n", data[0].Recipient.Address) }
}
                </pre>
            </div>
        </div>
    </div>
</section> <!-- /#memory -->

<section id = 'delivered' class = 'parallax'>
    <div class = 'container'>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'post-it'>
                    <i class = 'fa fa-truck'></i>
                </div>
            </div>
            <div class = 'heading col-sm-8 col-sm-offset-0'>
                <h2 class = 'in-desc'>配信成功も解析結果に含める</h2>
                <p class = 'description ja cation'>
                    <span class = 'value'>Sisimai</span>クラスの
                    <span class = 'value'>make()</span>メソッドは{{ site.html.ss }} 5.0.0で廃止になりました。
                    新たに実装された<span class = 'value'>rise()</span>メソッドをかわりに使ってください。
                </p>
                <p class = 'description ja'>
                    <span class = 'value'>Sisimai</span>クラスの<span class = 'value'>rise()</span>と
                    <span class = 'value'>dump()</span>は第二引数に<kbd>delivered</kbd>
                    を指定することによって、配信が成功した事を通知するメールも解析結果に含めることができます。
                </p>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'>email</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>配信成功のサンプルメール</h3>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/message-3.png'>
                    配送が成功したメールは
                    <a href = 'https://github.com/sisimai/set-of-emails' target = 'new'>github.com/sisimai/set-of-emails</a>
                    リポジトリの
                    <a href = 'https://github.com/sisimai/set-of-emails/blob/master/maildir/bsd/rfc3464-28.eml' target = 'new'>
                        rfc3464-28.eml
                    </a>
                    がサンプルとして用意してあります。
                    ここでは、このメールを解析するサンプルコードを紹介します。
                </p>
            </div>
        </div>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Perl</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>delivered =&gt; 1</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/dinosaur-1.png'>
                    <span class = 'value'>rise()</span>と<span class = 'value'>dump()</span>の第二引数に
                    <kbd>delivered =&gt; 1</kbd>を指定すると、
                    配信に成功したメール(配信通知)も解析結果に含まれるようになります。

                    <span class = 'value'>delivered</span>に偽となる値(<kbd>0</kbd>,<kbd>undef</kbd>,<kbd>''</kbd>)
                    を指定した場合は、解析結果は生成されません。
                </p>
                <pre class = 'prettyprint'><span class = 'shebang'>#! /usr/bin/env perl</span>
use Sisimai;
my $f = './set-of-emails/maildir/bsd/rfc3464-28.eml';
my $v = Sisimai->rise($f, <strong>'delivered' => 1</strong>);
for my $e ( @$v ) {
    print $e->action;           # "delivered"
    print $e->deliverystatus;   # "2.1.5"
    print $e->reason;           # "delivered"
    print $e->diagnosticcode;   # "250 2.1.5 Ok"
    print $e->hardbounce;       # 0
}
                </pre>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Ruby</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>delivered: true</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/ruby-1.png'>
                    Perl版と同様に、Ruby版{{ site.html.ss }}でも<span class = 'value'>rise()</span>と
                    <span class = 'value'>dump()</span>の第二引数に<kbd>delivered: true</kbd>を指定すると、
                    配信に成功したメール(配信通知)も解析結果に含まれるようになります。
                    <span class = 'value'>delivered</span>に偽となる値(<kbd>nil</kbd>,<kbd>false</kbd>)を指定した場合は、
                    解析結果は生成されません。
                </p>
                <pre class = 'prettyprint'><span class = 'shebang'>#! /usr/bin/env ruby</span>
require 'sisimai'
f = './set-of-emails/maildir/bsd/rfc3464-28.eml'
v = Sisimai.rise(f, <strong>delivered: true</strong>)
v.each do |e|
  puts e.action         # "delivered"
  puts e.deliverystatus # "2.1.5"
  puts e.reason         # "delivered"
  puts e.diagnosticcode # "250 2.1.5 Ok"
  puts e.hardbounce     # false
end
                </pre>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Go</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>args.Delivered = true</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/golang-1.png' width = '80'>
                    Perl版やRuby版と同様にGo版{{ site.html.ss }}でも<span class = 'value'>Rise()</span>と
                    <span class = 'value'>Dump()</span>の第二引数に
                    指定する<span class = 'value'>
                        <a href = '{{ site.sisimai.repository.golang }}/blob/5-stable/sis/decoding-args.go' target = 'new'>
                            sis.DecodingArgs
                        </a>
                    </span> 構造体の<span class = 'value'>Delivered</span>
                    に<kbd>true</kbd>を指定すると、配信に成功したメール(配信通知)も
                    解析結果に含まれるようになります。<span class = 'value'>Delivered</span>の初期値は
                    <span class = 'value'>false</span>です。
                </p>
                <pre class = 'prettyprint'><span class = 'shebang'>package main</span>
import "fmt"
import "libsisimai.org/sisimai"

func main() {
    path := "./set-of-emails/maildir/bsd/rfc3464-28.eml"
    args := sisimai.Args()
    <strong>args.Delivered = true</strong>

    sisi, _ := sisimai.Rise(path, args)
    if len(*sisi) &gt; 0 { fmt.Printf("Recipient = %s\n", *sisi[0].Recipient.Address }
}
                </pre>
            </div>
        </div>
    </div>
</section> <!-- /#delivered -->

<section id = 'vacation' class = 'not-parallax'>
    <div class = 'container'>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'post-it'>
                    <i class = 'fa fa-plane-departure'></i>
                </div>
            </div>
            <div class = 'heading col-sm-8 col-sm-offset-0'>
                <h2 class = 'in-desc'>不在応答(Vacation)も解析結果に含める</h2>
                <p class = 'description ja cation'>
                    <span class = 'value'>Sisimai</span>クラスの
                    <span class = 'value'>make()</span>メソッドは{{ site.html.ss }} 5.0.0で廃止になりました。
                    新たに実装された<span class = 'value'>rise()</span>メソッドをかわりに使ってください。
                </p>
                <p class = 'description ja cation'>
                    {{ site.html.ss }} 5.0.0でバウンス理由が <span class = 'value'>vacation</span>となる
                    バウンスメールはデフォルトで解析されなくなりました。必要な場合は
                    <span class = 'value'>vacation</span>パラメーターを<span class = 'value'>rise()</span>
                    メソッドに指定してください。
                </p>
                <p class = 'description ja'>
                    <span class = 'value'>Sisimai</span>クラスの<span class = 'value'>rise()</span>と
                    <span class = 'value'>dump()</span>は第二引数に<kbd>vacation</kbd>
                    を指定することによって、不在応答(Vacation)のメールも解析結果に含めることができます。
                </p>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'>email</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>不在応答(Vacation)のサンプルメール</h3>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/message-3.png'>
                    不在応答のメールは
                    <a href = 'https://github.com/sisimai/set-of-emails' target = 'new'>github.com/sisimai/set-of-emails</a>
                    リポジトリの
                    <a href = 'https://github.com/sisimai/set-of-emails/blob/master/maildir/bsd/rfc3834-01.eml' target = 'new'>
                        rfc3834-01.eml
                    </a>
                    がサンプルとして用意してあります。
                    ここでは、このメールを解析するサンプルコードを紹介します。
                </p>
            </div>
        </div>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Perl</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>vacation =&gt; 1</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/dinosaur-1.png'>
                    <span class = 'value'>rise()</span>と<span class = 'value'>dump()</span>の第二引数に
                    <kbd>vacation=&gt; 1</kbd>を指定すると、
                    不在応答のメールも解析結果に含まれるようになります。<span class = 'value'>vacation</span>
                    に偽となる値(<kbd>0</kbd>,<kbd>undef</kbd>,<kbd>''</kbd>)を指定した場合は、解析結果は生成されません。
                </p>
                <pre class = 'prettyprint'><span class = 'shebang'>#! /usr/bin/env perl</span>
use Sisimai;
my $f = './set-of-emails/maildir/bsd/rfc3834-01.eml';
my $v = Sisimai->rise($f, <strong>'vacation' => 1</strong>);
for my $e ( @$v ) {
    print $e->action;           # ""
    print $e->deliverystatus;   # ""
    print $e->reason;           # "vacation"
    print $e->diagnosticcode;   # "I am currently away returning to the office on May 5th."
    print $e->hardbounce;       # 0
}
                </pre>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Ruby</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>vacation: true</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/ruby-1.png'>
                    Perl版と同様に、Ruby版{{ site.html.ss }}でも<span class = 'value'>rise()</span>と
                    <span class = 'value'>dump()</span>の第二引数に<kbd>vacation: true</kbd>を指定すると、
                    不在通知のメールも解析結果に含まれるようになります。<span class = 'value'>vacation</span>
                    に偽となる値(<kbd>nil</kbd>,<kbd>false</kbd>)を指定した場合は、解析結果は生成されません。
                </p>
                <pre class = 'prettyprint'><span class = 'shebang'>#! /usr/bin/env ruby</span>
require 'sisimai'
f = './set-of-emails/maildir/bsd/rfc3834-01.eml'
v = Sisimai.rise(f, <strong>vacation: true</strong>)
v.each do |e|
  puts e.action         # ""
  puts e.deliverystatus # ""
  puts e.reason         # "vacation"
  puts e.diagnosticcode # "I am currently away returning to the office on May 5th."
  puts e.hardbounce     # false
end
                </pre>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Go</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>args.Vacation = true</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/golang-1.png' width = '80'>
                    Perl版やRuby版と同様にGo版{{ site.html.ss }}でも<span class = 'value'>Rise()</span>関数と
                    <span class = 'value'>Dump()</span>関数の第二引数に指定する構造体
                    <span class = 'value'>
                        <a href = '{{ site.sisimai.repository.golang }}/blob/5-stable/sis/decoding-args.go' target = 'new'>
                            sis.DecodingArgs
                        </a>
                    </span> の
                    <span class = 'value'>Vacation</span>に<kbd>true</kbd>を指定すると、
                    不在応答のメールも解析結果に含まれるようになります。
                    <span class = 'value'>Vacation</span>の初期値は<span class = 'value'>false</span>です。
                </p>
                <pre class = 'prettyprint'><span class = 'shebang'>package main</span>
import "fmt"
import "libsisimai.org/sisimai"

func main() {
    path := "./set-of-emails/maildir/bsd/rfc3834-01.eml"
    args := sisimai.Args()
    <strong>args.Vacation = true</strong>

    sisi, _ := sisimai.Rise(path, args)
    if len(*sisi) &gt; 0 { fmt.Printf("Recipient = %s\n", *sisi[0].Recipient.Address }
}
                </pre>
            </div>
        </div>
    </div>
</section> <!-- /#vacation -->

<section id = 'callback' class = 'parallax'>
    <div class = 'container'>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'post-it'>
                    <i class = 'fa fa-reply-all'></i>
                </div>
            </div>
            <div class = 'heading col-sm-8 col-sm-offset-0'>
                <h2>コールバック機能</h2>
                <p class = 'description ja cation'>
                    <span class = 'value'>Sisimai</span>クラスの
                    <span class = 'value'>make()</span>メソッドは{{ site.html.ss }} 5.0.0で廃止になりました。
                    新たに実装された<span class = 'value'>rise()</span>メソッドをかわりに使ってください。
                </p>
                <p class = 'description ja cation'>
                    {{ site.html.ss }} 5.0.0でコールバック機能の仕様(引数の数・型)が変りました。
                    非互換の変更につき、Version 4でのコールバック機能は<span class = 'value'>4-stable</span>
                    ブランチの
                    <a href = 'https://github.com/sisimai/p5-sisimai/blob/4-stable/README-JA.md#callback-feature'>GitHub/Callback Feature</a>
                    を確認してください。
                </p>
                <p class = 'description ja'>
                    {{ site.html.ss }} 4.19.0から実装されたコールバック機能を使用すると、
                    <span class = 'value'>Sisimai::Fact</span>または<span class = 'value'>Sisimai::Message</span>
                    の<span class = 'value'>catch()</span>メソッドを通して、バウンスメールを独自に処理した結果を取得することができます。
                    この機能は{{ site.html.ss }}が解析結果に含めない元メッセージ全体や
                    元メッセージの特定のヘッダの値(例えば配信IDなど)を取り出したりするのに便利です。
                </p>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'>c___</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>c___に渡す引数(PerlとRuby)</h3>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/dinosaur-1.png'>
                    <img class = 'lhs' src = '/static/images/icon/ruby-1.png'>
                    <span class = 'value'>Sisimai</span>クラスの<span class = 'value'>rise()</span>メソッドにおける
                    <span class = 'value'>c___</span> (<span class = 'value'>c</span>と<span class = 'value'>_</span>が三つ、
                    釣り針に見える)に渡せる引数は、Perlのフックメソッド(サブルーチン)には<strong>配列リファレンス1つ</strong>、
                    Rubyのフックメソッドには<strong>Arrayオブジェクト1つ</strong>
                    です。引数の構造は以下のようになっています。
                </p>
                <div class = 'table-responsive'>
                    <table class = 'table table-hover table-bordered'>
                        <thead>
                            <tr>
                                <th><span class = 'value'>c___</span>に渡す配列のインデックス</th>
                                <th>処理対象</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class = 'ltext'>[0] (下記コード例にある<span class = 'value'>$code0</span>)</td>
                                <td>
                                    メールのヘッダー<span class = 'value'>headers</span>および本文
                                    <span class = 'value'>message</span>
                                </td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>[1] (下記コード例にある<span class = 'value'>$code1</span>)</td>
                                <td>元メールのファイルに対して</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <pre class = 'prettyprint'>
my $code0 = sub {
    my $args = shift;
    my $head = $args->{'headers'}; # ヘッダー
    my $body = $args->{'message'}; # 本文
};
my $code1 = sub {
    my $args = shift;
    my $kind = $args->{'kind'}; # (String)  Sisimai::Mail->kind
    my $mail = $args->{'mail'}; # (*String) Entire email message
    my $path = $args->{'path'}; # (String)  Sisimai::Mail->path
    my $fact = $args->{'fact'}; # (*Array)  List of Sisimai::Fact
};
my $list = Sisimai->rise('/path/to/mbox', 'c___' => [$code0, $code1]);
                </pre>

            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'>c___[0]</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>c___[0]の入力値</h3>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/dinosaur-1.png'>
                    <img class = 'lhs' src = '/static/images/icon/ruby-1.png'>
                    <span class = 'value'>message</span>で得られる文字列はバウンスメールの本文です。
                    バウンスメールそのもののヘッダーは含まれていませんので、ハッシュ化された
                    <span class = 'value'>headers</span>を参照してください。
                    <br />
                </p>

                <div class = 'table-responsive'>
                    <table class = 'table table-hover table-bordered'>
                        <thead>
                            <tr>
                                <th>キー名</th>
                                <th>データ型</th>
                                <th>説明</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class = 'ltext'>headers</td>
                                <td>Hash</td>
                                <td>バウンスメールのヘッダ部分(ハッシュ化済み)</td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>message</td>
                                <td>String</td>
                                <td>ヘッダーは含まないバウンスメールのメール本文</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'>c___[1]</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>c___[1]の入力値</h3>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/dinosaur-1.png'>
                    <img class = 'lhs' src = '/static/images/icon/ruby-1.png'>
                    <span class = 'value'>mail</span>で得られる文字列は、バウンスメールそのもの
                    のヘッダーも含むバウンスメール全体です。
                    <br />
                    <br />
                    <br />
                </p>

                <div class = 'table-responsive'>
                    <table class = 'table table-hover table-bordered'>
                        <thead>
                            <tr>
                                <th>キー名</th>
                                <th>データ型</th>
                                <th>説明</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class = 'ltext'>kind</td>
                                <td>String</td>
                                <td>元メールファイルの種類</td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>mail</td>
                                <td>*String</td>
                                <td>ヘッダーも含むバウンスメール全体</td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>path</td>
                                <td>String</td>
                                <td>元メールファイルへのPATH</td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>fact</td>
                                <td>Array</td>
                                <td>解析結果である<span class = 'value'>Sisimai::Fact</span>のリスト</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'>Go</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>Callback0, Callback1に渡す引数(Go)</h3>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/golang-1.png' width = '80'>
                    <span class = 'value'>libsisimai.org/sisimai</span>パッケージの<span class = 'value'>Rise()</span>
                    関数における
                    <span class = 'value'>
                    <a href = '{{ site.sisimai.repository.golang }}/blob/5-stable/sis/decoding-args.go' target = 'new'>
                        sis.DecodingArgs
                    </a>
                    </span>
                    構造体の<span class = 'value'>Callback0</span>と
                    <span class = 'value'>Callback1</span>の引数と戻り値はそれぞれ以下のような構造になっています。
                </p>
                <div class = 'table-responsive'>
                    <table class = 'table table-hover table-bordered'>
                        <thead>
                            <tr>
                                <th>
                                    <span class = 'value'>sis.DecodingArgs</span>
                                </th>
                                <th>引数</th>
                                <th>戻り値</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class = 'ltext'>Callback0</td>
                                <td>
                                    <span class = 'value'>*sis.CallbackArg0</span><br /><br />
                                    <ul>
                                        <li>Headers <span class = 'value'>map[string][]string</span></li>
                                        <ul><li>バウンスメールのヘッダー部分</li></ul>
                                        <li>Payload <span class = 'value'>*string</span></li>
                                        <ul><li>ヘッダーを<strong>除く</strong>バウンスメールのメール本文</li></ul>
                                    </ul>
                                </td>
                                <td>
                                    <ul>
                                        <li>map[string]interface{}</li>
                                        <li>error</li>
                                    </ul>
                                </td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>Callback1</td>
                                <td>
                                    <span class = 'value'>*sis.CallbackArg0</span><br /><br />
                                    <ul>
                                        <li>Path <span class = 'value'>string</span> 元メールのPath</li>
                                        <li>Kind <span class = 'value'>string</span> 元メールの種類</li>
                                        <ul>
                                            <li>"mailbox": UNIX mbox形式</li>
                                            <li>"maildir": Maildir/形式</li>
                                            <li>"memory": 変数からの読み込み</li>
                                            <li>"stdin": STDINからの読み込み</li>
                                        </ul>
                                        <li>
                                            Mail <span class = 'value'>*string</span>
                                            ヘッダーを<strong>含む</strong>バウンスメール全体
                                        <li>Fact <span class = 'value'>*[]sis.Fact</span> 解析済みデータ</li>
                                    </ul>
                                </td>
                                <td>
                                    <ul>
                                        <li>bool</li>
                                        <li>error</li>
                                    </ul>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <pre class = 'prettyprint'>
args := sisimai.Args()
args.Callback0 = func(arg *sisimai.CallbackArg0) (map[string]interface{}, error) {
    fmt.Printf("Headers = %v\n", (*arg).Headers) // ヘッダー全て
    fmt.Printf("- From: = %s\n", (*arg).Headers["from"][0])
    fmt.Printf("- Subject: = %s\n", (*arg).Headers["subject"][0])
    fmt.Printf("Body = %s\n", (*arg).Payload)    // 本文
    data := make(map[string]interface{})
    data["from"] = (*arg).Headers["from"][0]
    return data, nil
}
args.Callback1 = func(arg *sisimai.CallbackArg1) (bool, error) {
    fmt.Printf("- Path = %s\n", arg.Path)  // 元メールファイルのPATH
    fmt.Printf("- Kind = %s\n", arg.Kind)  // 元メールファイルの種類
    fmt.Printf("Body = %s\n", (*arg.Mail)) // 本文
    fmt.Printf("Fact = %s\n", (*arg.Fact)) // 解析結果
    return true, nil
}

sisi, nyaan := sisimai.Rise(path, args)
                </pre>

            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'>email</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>電子メール: rhost-google-03.eml</h3>
                <p class = 'description ja'>
                    <a href = 'https://github.com/sisimai/set-of-emails/blob/master/maildir/bsd/rhost-google-03.eml' target = 'new'>
                        rhost-google-03.eml
                    </a>にある以下の内容をコールバックで実行するコードによって取得し、元メールへの操作例を示します。
                </p>
                <ul>
                    <li>バウンスメールのヘッダにある<span class = 'value'>Return-Path</span>の値を取得</li>
                    <li>バウンスメールのヘッダにある<span class = 'value'>From</span>の値を取得</li>
                    <li>本文の<span class = 'value'>X-Postfix-Queue-ID</span>の値を取得</li>
                    <li>STDINからの入力なら元メールを別のPATHへ保存する</li>
                </ul>

                <pre class = 'prettyprint'><strong>Return-Path: <></strong>
Received: from mail4.example.com (mx4.example.com [192.0.2.24])
    by secure.example.jp (Postfix) with ESMTPS id 4SnNbh0r3mz24sXs
    for <postmaster@example.jp>; Thu,  9 Apr 2022 23:34:45 +0900 (JST)
Received: by mail4.example.com (Postfix)
    id t8WLKlmm99zqL71C; Thu,  9 Apr 2022 23:34:45 +0900 (JST)
Authentication-Results: secure.example.jp; spf=fail smtp.helo=mail4.example.com
Date: Thu,  9 Apr 2022 23:34:45 +0900 (JST)
<strong>From: MAILER-DAEMON@mail4.example.com (Mail Delivery System)</strong>
Subject: Undelivered Mail Returned to Sender
To: nginx@mail4.example.com
...
<kijitora@google.example.com> (expanded from <neko@example.co.jp>): host
    gmail-smtp-in.l.google.com[64.233.188.26] said: 550-5.7.26 The MAIL FROM
    domain [mail4.example.com] has an SPF record with a 550-5.7.26 hard fail
    policy (-all) but it fails to pass SPF checks with the ip: 550-5.7.26
    [192.0.2.24]. To best protect our users from spam and phishing,
    550-5.7.26 the message has been blocked. For instructions on setting up
    550-5.7.26 authentication, go to 550 5.7.26
    https://support.google.com/mail/answer/81126#authentication
    2-222222630d46222222b002b2d2neko2cat2222222cat.22 - gsmtp (in reply to end
    of DATA command)

--Lms5yfCw0Vz5CRp3.1647426971/mail4.example.com
Content-Description: Delivery report
Content-Type: message/delivery-status

Reporting-MTA: dns; mail4.example.com
<strong>X-Postfix-Queue-ID: Lms5yfCw0Vz5CRp3</strong>
X-Postfix-Sender: rfc822; nginx@mail4.example.com
Arrival-Date: Thu,  9 Apr 2022 23:34:45 +0900 (JST)

Final-Recipient: rfc822; kijitora@google.example.com
Original-Recipient: rfc822;neko@example.co.jp
Action: failed
Status: 5.7.26
Remote-MTA: dns; gmail-smtp-in.l.google.com
Diagnostic-Code: smtp; 550-5.7.26 The MAIL FROM domain [mail4.example.com] has
...
                </pre>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Perl</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>Sisimai-&gt;rise($f, 'c___' => [$c0, $c1])</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/dinosaur-1.png'>
                    Sisimaiクラスの<span class = 'value'>rise()</span>と<span class = 'value'>dump()</span>
                    メソッドに、実行したい処理内容を書いたサブルーチンのコードリファレンス2個を第二引数
                    <span class = 'value'>c___</span>として渡すことができます。
                </p>
                <pre class = 'prettyprint'>% <kbd>cat set-of-emails/maildir/bsd/rhost-google-03.eml | perl ./sisid.pl</kbd></pre>
                <pre class = 'prettyprint'><span class = 'shebang'>#! /usr/bin/env perl</span>
# sisid.pl
use Sisimai;
my $c0 = sub {
    my $args = shift;
    my $data = { 'queue-id' => '', 'from' => '', 'return-path' => '' };

    $data->{'return-path'} = $args->{'headers'}->{'return-path'} || '';
    $data->{'from'} = $args->{'headers'}->{'from'} || '';
    if( $args->{'message'} =~ m/^X-Postfix-Queue-ID:\s*(.+)$/m ) {
        $data->{'queue-id'} = $1;
    }
    return $data;
};
my $c1 = sub {
    my $args = shift;
    my $kind = $args->{'kind'}; # (String)  Sisimai::Mail->kind
    my $mail = $args->{'mail'}; # (*String) Entire email message
    my $path = $args->{'path'}; # (String)  Sisimai::Mail->path

    if $kind eq 'stdin' {
        my $f = IO::File->new("/tmp/sisimai-decoded-1.eml", 'w');
        print $f $$mail; $f->close;
    }
};

my $rv = Sisimai->rise(STDIN, 'c___' => [$c0, $c1]);
printf("From: %s\n", $rv->[0]->{'catch'}->{'from'});
printf("Queue-ID: %s\n", $rv->[0]->{'catch'}->{'queue-id'});
printf("Return-Path: %s\n", $rv->[0]->{'catch'}->{'return-path'});
                </pre>
            </div>
        </div>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Ruby</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>Sisimai.rise(f, c___: [c0, c1])</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/ruby-1.png'>
                    <span class = 'value'>Sisimai</span>クラスの<span class = 'value'>rise()</span>と
                    <span class = 'value'>dump()</span>メソッドに、実行したい処理内容を書いた
                    <span class = 'value'>Proc</span>オブジェクトを<span class = 'value'>c___:</span>
                    として渡すことができます。
                </p>
                <pre class = 'prettyprint'>% <kbd>cat set-of-emails/maildir/bsd/rhost-google-03.eml | ruby ./sisid.rb</kbd></pre>
                <pre class = 'prettyprint'><span class = 'shebang'>#! /usr/bin/env ruby</span>
# sisid.rb
require 'sisimai'
c0 = lambda do |args|
  data = { 'queue-id' => '', 'from' => '', 'return-path' => '' }
  data['return-path'] = args['headers']['return-path'] || ''
  data['from'] = args['headers']['from'] || ''
  if cv = args['message'].match(/^X-Postfix-Queue-ID:\s*(.+)$/)
    data['queue-id'] = cv[1]
  end
  return data
end

c1 = lambda do |args|
  kind = args['kind'] # (String)  Sisimai::Mail.kind
  mail = args['mail'] # (*String) Entire email message
  path = args['path'] # (String)  Sisimai::Mail.path

  if kind == 'stdin'
    File.open("/tmp/sisimai-decoded-1.eml", "w") do |f|
      f.puts(mail)
    end
  end
end

rv = Sisimai.rise(fn, c___: [c0, c1])
printf("From: %s\n", rv[0].catch['from'])
printf("X-Postfix-Queue-ID: %s\n", rv[0].catch['queue-id'])
printf("Return-Path: %s\n", rv[0].catch['return-path'])
                </pre>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Go</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h4 class = 'in-desc'>sisimai.Rise(path, args)</h4>
                <p class = 'description ja'>
                    <img class = 'lhs' src = '/static/images/icon/golang-1.png' width = '80'>
                    <span class = 'value'>libsisimai.org/sisimai</span>パッケージの<span class = 'value'>Rise()</span>関数と
                    <span class = 'value'>Dump()</span>関数に渡す
                    <span class = 'value'>
                        <a href = 'https://github.com/sisimai/go-sisimai/blob/5-stable/sis/decoding-args.go' target = 'new'>sis.DecodingArgs</a>
                    </span>構造体の
                    <span class = 'value'>Callback0</span>と<span class = 'value'>Callback1</span>に
                    実行したい処理内容を書いた関数を代入して渡すことができます。
                </p>
                <pre class = 'prettyprint'>% <kbd>cat set-of-emails/maildir/bsd/rhost-google-03.eml | go run ./sisid.go</kbd></pre>
                <pre class = 'prettyprint'><span class = 'shebang'>package main</span>
// sisid.go
import "fmt"
import "strings"
import "libsisimai.org/sisimai"

func main() {
    args := sisimai.Args() // sis.DecodingArgs{}
    list := []string{"Return-Path", "From"}

    args.Callback0 = func(arg *sisimai.CallbackArg0) (map[string]interface{}, error) {
        data := make(map[string]interface{})
        data["queue-id"] = ""

        for _, e := range list {
            ff := strings.ToLower(e)
            if len((*arg).Headers[ff]) == 0 || (*arg).Headers[ff][0] == "" { continue }
            data[ff] = (*arg).Headers[ff][0]
        }

        if arg.Payload != nil && len(*arg.Payload) > 0 {
            name := "X-Postfix-Queue-ID"
            mesg := *arg.Payload
            p0 := strings.Index(mesg, "\n" + name + ": "); if p0 < 0 { return data, nil }
            p1 := p0 + len(name) + 3
            p2 := strings.Index(mesg[p1:], "\n");          if p2 < 0 { return data, nil }
            data["queue-id"] = mesg[p1:p1 + p2]
        }
        return data, nil
    }
    args.Callback1 = func(arg *sisimai.CallbackArg1) (bool, error) {
        if nyaan := ioutil.WriteFile("/tmp/sisimai-decoded-1.eml", []byte(*arg.Mail), 0600); nyaan != nil {
            return false, nyaan
        }
        return true, nil
    }

    // sisi is a pointer to []sis.Facti
    sisi, nyaan := sisimai.Rise("STDIN", args)
    if len(*sisi) > 0 {
        list = append(list, "Queue-ID")
        for _, e := range *sisi {
            // e is a sis.Fact struct
            fmt.Printf("Recipient = %s\n", e.Recipient.Address)
            re, as := e.Catch.(map[string]interface{})
            if as == false { continue }
            for _, f := range list {
                ff := strings.ToLower(f)
                if ca, ok := re[ff].(string); ok {
                    fmt.Printf("- Catch[%s] = %s\n", f, ca)
                }
            }
        }
    }
    // nyaan is a pointer to []sis.NotDecoded
    if len(*nyaan) > 0 { fmt.Fprintf(os.Stderr, "%v\n", *nyaan) }
}
                </pre>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'>JSON</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>dump()で出力したJSON</h3>
                <p class = 'description ja'>
                    <span class = 'value'>Sisimai</span>クラスの<span class = 'value'>dump()</span>
                    メソッドにフックメソッドを渡して得たJSON文字列は次のような内容になります。
                </p>
                <pre class = 'prettyprint'>[
  {
    "addresser": "kijitora@google.example.com",
    "messageid": "vDcsF1hr4zzywp69@mail4.example.com",
    "recipient": "kijitora@google.example.com",
    "diagnosticcode": "host gmail-smtp-in.l.google.com[64.233.188.26] said: The MAIL FROM domain [mail4.example.com] has an SPF record with a hard fail policy (-all) but it fails to pass SPF checks with the ip: [192.0.2.24]. To best protect our users from spam and phishing, the message has been blocked. For instructions on setting up authentication, go to https://support.google.com/mail/answer/81126#authentication 2-222222630d46222222b002b2d2neko2cat2222222cat.22 - gsmtp (in reply to end of DATA command)",
    "smtpagent": "Postfix",
    "destination": "google.example.com",
    "alias": "neko@example.co.jp",
    "reason": "authfailure",
    "lhost": "gmail-smtp-in.l.google.com",
    "senderdomain": "google.example.com",
    "token": "fe75b94dd0489b106fa041c460064dd6afa8196b",
    "subject": "Nyaan",
    "deliverystatus": "5.7.26",
    "timezoneoffset": "+0900",
    "listid": "",
    "origin": "set-of-emails/maildir/bsd/rhost-google-03.eml",
    "action": "failed",
    "timestamp": 1649514885,
    "hardbounce": 0,
    "rhost": "gmail-smtp-in.l.google.com",
    "catch": {
      "size": 4436,
      "kind": "Mailbox",
      "from": "MAILER-DAEMON@mail4.example.com (Mail Delivery System)",
      "return-path": "<>",
      "queue-id": "Lms5yfCw0Vz5CRp3",
    },
    "diagnostictype": "SMTP",
    "replycode": 550,
    "feedbacktype": "",
    "smtpcommand": "DATA"
  }
]
                </pre>
            </div>
        </div>

    </div>
</section> <!-- #callback -->

