---
"layout": "document"
"directory": "diff/"
"title": "Sisimai 5における破壊的な変更点"
"description": "Sisimaiのversion 5とversion 4の機能・仕様における違い"
"author": "azumakuniyuki"
---
<a id = 'tohash' href = '#'></a>
<header id = 'home'>
    <div class = 'main-nav'>
        <div class = 'container'>
            <div class = 'navbar-header'>
                <button type = 'button' class = 'navbar-toggle' data-toggle = 'collapse' data-target = '.navbar-collapse'>
                    <span class = 'sr-only'>Toggle navigation</span>
                    <span class = 'icon-bar'></span>
                    <span class = 'icon-bar'></span>
                    <span class = 'icon-bar'></span>
                </button>
                <a class = 'navbar-brand' href = '/'>
                    <h1>
                        <img class = 'img-responsive' src = '/static/images/logo/sisimai-logotype-w11.png' 
                            width = '144' alt = 'Sisimai: Mail Analyzing Interface'>
                    </h1>
                </a>
            </div>
            <div class = 'collapse navbar-collapse'>
                <ul class = 'nav navbar-nav navbar-right'>
                    <li class = 'others'><a href = '/ja'><i class = 'fa fa-home'></i></a></li>
                    <li class = 'scroll active'><a href = '#index'><i class = 'fa fa-arrow-circle-up'></i></a></li>
                    <li class = 'scroll'><a href = '#system'>動作環境と機能</a></li> 
                    <li class = 'scroll'><a href = '#reason'>バウンス理由</a></li>
                    <li class = 'scroll'><a href = '#decode'>名前空間</a></li> 
                    <li class = 'others'><a href = '/ja/diff/between-sisimai-and-bouncehammer.html'>{{ site.html.bh }}との違い</a></li> 
                    <li class = 'others'><a href = '/ja/docs/'>ドキュメント</a></li>
                    <li class = 'others'><a href = '/en/diff/'><i class = 'fa fa-language'></i></a></li>
                </ul>
            </div>
        </div>
    </div> <!-- /#main-nav -->
</header> <!-- /#home -->

<section id = 'index'>
    <div class = 'container'>
        <div class = 'heading'>
            <div class = 'row'>
                <div class = 'text-center col-sm-8 col-sm-offset-2'>
                    <img src = '/static/images/logo/sisimai-x01.png' width = '20%'>
                    <h2>{{ site.html.ss }} 4との違い</h2>
                    <p class = 'description ja'>
                        このページでは{{ site.html.ss }}(Perl版とRuby版)のVersion 5で変更になった内容を、
                        動作環境や機能、モジュール名や追加されたバウンス理由などについて説明しています。
                    </p>
                </div>
            </div> 
        </div>
        <div class = 'row'>
            <div class = 'text-center index-table'>
                <div class = 'col-sm-3 col-sm-offset-0'>
                    <div class = 'index-icon'>
                        <i class = 'fa fas fa-book-skull'></i>
                    </div>
                    <div class = 'index-info'>
                        <h3>動作環境と機能</h3>
                        <p class = 'description ja'>
                            {{ site.html.ss }} 5.0.0で変更になった動作環境やコールバック機能、
                            メソッド名や解析済みデータのクラス名と項目名について
                        </p>
                    </div>
                    <a href = '#system' class = 'btn btn-continue'>詳しく</a>
                </div>
                <div class = 'col-sm-3'>
                    <div class = 'index-icon'>
                        <i class = 'fa fa-envelopes-bulk'></i>
                    </div>
                    <div class = 'index-info'>
                        <h3>バウンス理由</h3>
                        <p class = 'description ja'>
                            {{ site.html.ss }} 5.0.0で追加された5つの新しいバウンス理由
                            (ドメイン認証関係やレピュテーションなど)について
                        </p>
                    </div>
                    <a href = '#reason' class = 'btn btn-continue'>詳しく</a>
                </div>
                <div class = 'col-sm-3'>
                    <div class = 'index-icon'>
                        <i class = 'fa fa-gears'></i>
                    </div>
                    <div class = 'index-info'>
                        <h3>名前空間</h3>
                        <p class = 'description ja'>
                            {{ site.html.ss }} 5.0.0で新規に追加された、または変更になったモジュール
                            /Gemの名前空間について
                        </p>
                    </div>
                    <a href = '#decode' class = 'btn btn-continue'>詳しく</a>
                </div>
                <div class = 'col-sm-3'>
                    <div class = 'index-icon'>
                        <i class = 'fa fa-hammer'></i>
                    </div>
                    <div class = 'index-info'>
                        <h3>{{ site.html.bh }}との違い</h3>
                        <p class = 'description ja'>
                            {{ site.html.ss }} 5.0.0と{{ site.html.bh }}の違いについて
                        </p>
                    </div>
                    <a href = '/en/diff/between-sisimai-and-bouncehammer.html' class = 'btn btn-continue'>詳しく</a>
                </div>
            </div>
        </div>
    </div>
</section> <!-- /#index -->

<section id = 'system' class = 'parallax'>
    <div class = 'container'>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'post-it'>
                    <i class = 'fas fa-book-skull'></i>
                </div>
            </div>
            <div class = 'heading col-sm-8 col-sm-offset-0'>
                <h2 class = 'in-desc'>動作環境と機能</h2>
                <p class = 'description ja'>
                    {{ site.html.ss }} 5で変更になった動作環境や機能など、ユーザー側にとって重要である
                    変更点について説明します。
                </p>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'><i class = 'fas fa-person-running'></i></div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>PerlとRubyの最低バージョン</h3>
            </div>
        </div>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Perl</div>
                <div class = 'index-text'>Ruby</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <p class = 'description ja'>
                    {{ site.html.ss }} 5からPerl版は
                    <strong>{{ site.sisimai.workson.perl[0] }}以上</strong>が、Ruby版は
                    <strong>{{ site.sisimai.workson.ruby[0] }}以上が必要</strong>になりました。
                    <strong>
                    <em class = 'warn'>インストールやアップグレードを実行する前にシステムのPerlや
                        Rubyのバージョンを必ず確認してください。</em>
                    </strong>
                </p>
                <pre class = 'prettyprint ltext'>% <kbd>perl -v</kbd>

This is perl 5, version 32, subversion 0 (v5.32.0) built for darwin-2level

Copyright 1987-2020, Larry Wall
                </pre>
                <pre class = 'prettyprint ltext'>% <kbd>ruby -v</kbd>
ruby 3.3.0 (2023-12-25 revision 5124f9ac75) [x86_64-darwin21]
                </pre>
                <hr>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'><i class = 'fas fa-skull'></i></div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>make()メソッドの廃止とrise()メソッドの新設</h3>
            </div>
        </div>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Perl</div>
                <div class = 'index-text'>Ruby</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <p class = 'description ja'>
                    {{ site.html.ss }} 5.0.0で<kbd>Sisimai</kbd>クラスの<kbd>make()</kbd>
                    メソッドが廃止になりました。<kbd>make()</kbd>メソッドは実行時に警告が出ますが
                    {{ site.html.ss }} 5.1.0までは使用可能です。
                </p>
                <p class = 'description ja'>
                    {{ site.html.ss }} 5.0.0で新しく実装された<kbd>rise()</kbd>メソッドを使ってください。
                </p>
                <pre class = 'prettyprint ltext'>% <kbd>perl -MSisimai -lE 'print Sisimai->make(shift)' ./test.eml</kbd>
 ***warning: Sisimai->make will be removed at v5.1.0. Use Sisimai->rise instead
% <kbd>perl -MSisimai -lE 'my $p = Sisimai->rise(shift)' ./test.eml</kbd>
                </pre>
                <pre class = 'prettyprint ltext'>% <kbd>ruby -rsisimai -e 'print Sisimai.make($*.shift)' ./test.eml</kbd>
 ***warning: Sisimai.make will be removed at v5.1.0. Use Sisimai.rise instead
% <kbd>ruby -rsisimai -e 'p = Sisimai.rise($*.shift)' ./test.eml</kbd>
                </pre>
                <hr>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'><i class = 'fas fa-skull'></i></div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>"softbounce"の廃止と"hardbounce"の新設</h3>
            </div>
        </div>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Perl</div>
                <div class = 'index-text'>Ruby</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <p class = 'description ja'>
                    {{ site.html.ss }} 5.0.0で<kbd>Sisimai::Data</kbd>クラスの<kbd>softbounce()</kbd>
                    メソッドと解析結果の<kbd>"softbounce"</kbd>が廃止になりました。<kbd>softbounce()</kbd>
                    メソッドは実行時に警告が出ますが{{ site.html.ss }} 5.1.0までは使用可能です。
                </p>
                <p class = 'description ja'>
                    {{ site.html.ss }} 5.0.0で新しく実装された<kbd>hardbounce()</kbd>メソッドならびに
                    解析結果の<kbd>"hardbounce"</kbd>を使ってください。
                </p>

                <pre class = 'prettyprint ltext'>% <kbd>perl -MSisimai -lE 'print Sisimai->rise(shift)->[0]->softbounce;' ./test.eml</kbd>
 ***warning: Sisimai::Fact->softbounce will be removed at v5.1.0.
            Use Sisimai::Fact->hardbounce instead
                </pre>
                <pre class = 'prettyprint ltext'>% <kbd>ruby -rsisimai -e 'print Sisimai.rise($*.shift)[0].softbounce' ./test.eml</kbd>
 ***warning: Sisimai::Fact.softbounce will be removed at v5.1.0.
            Use Sisimai::Fact.hardbounce instead
                </pre>
                <hr>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'><i class = 'fas fa-skull'></i></div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>Sisimai::Dataクラスの廃止</h3>
            </div>
        </div>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Perl</div>
                <div class = 'index-text'>Ruby</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <p class = 'description ja'>
                    解析結果のデータ構造を保持する<kbd>Sisimai::Data</kbd>クラスは{{ site.html.ss }}
                    5.0.0で<kbd>Sisimai::Fact</kbd>に変りました。PerlやRubyで解析結果のオブジェクト
                    のクラス名を参照している場合はご注意下さい。
                </p>
                <pre class = 'prettyprint ltext'>% <kbd>perl -MSisimai -lE 'print ref Sisimai->rise(shift)' ./test.eml</kbd>
Sisimai::Fact
                </pre>
                <pre class = 'prettyprint ltext'>% <kbd>ruby -rsisimai -e 'print Sisimai.rise($*.shift)[0].class' ./test.eml; echo</kbd>
Sisimai::Fact
                </pre>
                <hr>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'><i class = 'fas fa-plane-departure'></i></div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>"vacation"を解析しない</h3>
            </div>
        </div>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Perl</div>
                <div class = 'index-text'>Ruby</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <p class = 'description ja'>
                    {{ site.html.ss }} 5.0.0からバウンス理由が<kbd>"vacation"</kbd>となるバウンスメール
                    をデフォルトで解析しなくなりました。必要な場合は以下のように<kbd>vacation</kbd>
                    オプションを<kbd>Sisimai</kbd>クラスの<kbd>rise()</kbd>メソッド第二引数に指定
                    してください。
                </p>
                <pre class = 'prettyprint'><span class = 'shebang'>#! /usr/bin/env perl</span>
use Sisimai;
my $f = './set-of-emails/maildir/bsd/rfc3834-01.eml';
my $v = Sisimai->rise($f, <strong>'vacation' => 1</strong>);
for my $e ( @$v ) {
    print $e->action;           # ""
    print $e->deliverystatus;   # ""
    print $e->reason;           # "vacation"
    print $e->diagnosticcode;   # "I am currently away returning to the office on May 5th."
    print $e->hardbounce;       # 0
}
                </pre>
                <pre class = 'prettyprint'><span class = 'shebang'>#! /usr/bin/env ruby</span>
require 'sisimai'
f = './set-of-emails/maildir/bsd/rfc3834-01.eml'
v = Sisimai.rise(f, <strong>vacation: true</strong>)
v.each do |e|
  puts e.action         # ""
  puts e.deliverystatus # ""
  puts e.reason         # "vacation"
  puts e.diagnosticcode # "I am currently away returning to the office on May 5th."
  puts e.hardbounce     # false
end
                </pre>
                <hr>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-label'><i class = 'fas fa-phone-volume'></i></div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <h3 class = 'in-desc'>コールバック機能の引数</h3>
            </div>
        </div>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'index-text'>Perl</div>
                <div class = 'index-text'>Ruby</div>
            </div>
            <div class = 'col-sm-8 col-sm-offset-0'>
                <p class = 'description ja'>
                    {{ site.html.ss }} 5.0.0で<kbd>Sisimai</kbd>クラスの<kbd>rise()</kbd>メソッド
                    (旧<kbd>make()</kbd>メソッド)に渡すコールバック用の引数は、<kbd>hook</kbd>から
                    <kbd>c___</kbd>に変りました。
                </p>
                <p class = 'description ja'>
                    同時に、引数に入れるデータは2個の要素をもつ配列リファレンスまたは<kbd>Array</kbd>
                    オブジェクトに変っています。
                    詳細は<a href = '/ja/usage#callback'>コールバック機能</a>を確認してください。
                </p>
            </div>
        </div>

    </div>
</section>

<section id = 'reason'>
    <div class = 'container'>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'post-it'>
                    <i class = 'fa fa-envelopes-bulk'></i>
                </div>
            </div>
            <div class = 'heading col-sm-8 col-sm-offset-0'>
                <h2 class = 'in-desc'>バウンス理由の追加</h2>
                <p class = 'description ja'>
                    {{ site.html.ss }} 5.0.0で新たに5つのバウンス理由が実装されました。
                    主にGmailの<a href = 'https://support.google.com/a/answer/81126?hl=ja' target = 'new'>
                        メール送信者のガイドライン</a>にて言及されている要求を満たしていない場合に
                    返ってくるバウンス理由です。既に実装されているバウンス理由と同じく、解析結果の
                    <kbd>"reason"</kbd>の値は<kbd>"authfailure"</kbd>や<kbd>"notcompliantrfc"</kbd>
                    のようにスペース無しの全て小文字で表記されます。
                </p>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-8 col-sm-offset-2'>
                <div class = 'table-responsive'>
                    <table class = 'table table-hover table-condensed'>
                        <thead>
                            <tr>
                                <th class = 'ctext'>バウンスした原因</th>
                                <th class = 'ctext'>{{ site.html.ss }} 4での理由</th>
                                <th class = 'ctext'>{{ site.html.ss }} 5での理由(新設)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class = 'ltext'>ドメイン認証によるもの(SPF,DKIM,DMARC)</td>
                                <td class = 'ltext'>Security Error</td>
                                <td class = 'ltext'><strong><a href = '/ja/reason#authfailure'>Auth Failure</a></strong></td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>送信者のドメイン・IPアドレスの低いレピュテーション</td>
                                <td class = 'ltext'>Blocked</td>
                                <td class = 'ltext'><strong><a href = '/ja/reason#badreputation'>Bad Reputation</a></strong></td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>PTRレコードが未設定または無効なPTRレコード</td>
                                <td class = 'ltext'>Blocked</td>
                                <td class = 'ltext'><strong><a href = '/ja/reason#requireptr'>Require PTR</a></strong></td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>RFCに準拠していないメール</td>
                                <td class = 'ltext'>Security Error</td>
                                <td class = 'ltext'><strong><a href = '/ja/reason#notcompliantrfc'>Not Compliant RFC</a></strong></td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>単位時間の流量制限・送信速度が速すぎる</td>
                                <td class = 'ltext'>Security Error</td>
                                <td class = 'ltext'><strong><a href = '/ja/reason#speeding'>Speeding</a></strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>

<section id = 'decode' class = 'parallax'>
    <div class = 'container'>
        <div class = 'row'>
            <div class = 'col-sm-1 col-sm-offset-1'>
                <div class = 'post-it'>
                    <i class = 'fa fa-gear'></i>
                </div>
            </div>
            <div class = 'heading col-sm-8 col-sm-offset-0'>
                <h2 class = 'in-desc'>変更された名前空間</h2>
                <p class = 'description ja'>
                    {{ site.html.ss }} 5.0.0でいくつかの名前空間が変更されました。
                    <kbd>Sisimai</kbd>クラスの<kbd>rise()</kbd>メソッド(旧<kbd>make()</kbd>メソッド)
                    だけを使ってる場合は特に影響はありませんが、独自の解析スクリプト内部で処理を
                    分割している場合はクラス名の変更にご注意下さい。
                </p>
            </div>
        </div>

        <div class = 'row'>
            <div class = 'col-sm-8 col-sm-offset-2'>
                <div class = 'table-responsive'>
                    <table class = 'table table-hover table-condensed'>
                        <thead>
                            <tr>
                                <th class = 'ctext'>処理目的</th>
                                <th class = 'ctext'>{{ site.html.ss }} 4での名称</th>
                                <th class = 'ctext'>{{ site.html.ss }} 5での名称(変更・新設)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class = 'ltext'>解析結果を保持するオブジェクト</td>
                                <td class = 'ltext'>Sisimai::Data</td>
                                <td class = 'ltext'><strong>Sisimai::Fact</strong></td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>MIME構造を解析するクラス</td>
                                <td class = 'ltext'>Sisimai::MIME</td>
                                <td class = 'ltext'><strong>Sisimai::RFC2045</strong></td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>SMTPセッションログを解析するクラス</td>
                                <td class = 'ltext'>実装なし</td>
                                <td class = 'ltext'><strong>Sisimai::SMTP::Transcript</strong></td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>Microsoft Exchangeからのバウンスメール解析</td>
                                <td class = 'ltext'>Sisimai::Rhost::ExchangeOnline</td>
                                <td class = 'ltext'><strong>Sisimai::Rhost::Microsoft</strong></td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>Google Workspaceからのバウンスメール解析</td>
                                <td class = 'ltext'>Sisimai::Rhost::GoogleApps</td>
                                <td class = 'ltext'><strong>Sisimai::Rhost::Google</strong></td>
                            </tr>
                            <tr>
                                <td class = 'ltext'>Tencent(騰訊)からのバウンスメール解析</td>
                                <td class = 'ltext'>Sisimai::Rhost::TencentQQ</td>
                                <td class = 'ltext'><strong>Sisimai::Rhost::Tencent</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</section>

